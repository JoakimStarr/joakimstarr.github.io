<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å°è‹¹æœå’Œå®å®çš„æ‹çˆ±æ—¶é’Ÿ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #5a3d5c;
      overflow-x: hidden;
      position: relative;
      transition: background 0.8s ease;
    }

    /* å¿ƒå½¢èƒŒæ™¯ */
    .heart-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.3;
      pointer-events: none;
    }

    .heart {
      position: absolute;
      font-size: 20px;
      color: #ff6b8b;
      animation: float 8s infinite ease-in-out;
      pointer-events: none;
      user-select: none;
    }

    /* ä¸»å®¹å™¨ */
    .container {
      background: rgba(255, 255, 255, 0.92);
      backdrop-filter: blur(12px);
      border-radius: 24px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      padding: 35px;
      max-width: 650px;
      width: 92%;
      text-align: center;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.6);
      animation: fadeIn 1s ease-out;
    }

    /* æ ‡é¢˜æ ·å¼ */
    .header {
      margin-bottom: 30px;
      position: relative;
    }

    .header h1 {
      font-size: 2.4rem;
      color: #ff6b8b;
      margin-bottom: 12px;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
      font-weight: 700;
    }

    .header p {
      font-size: 1.3rem;
      color: #8a6d8f;
      font-weight: 500;
    }

    /* è®¡æ—¶å™¨æ ·å¼ */
    .timer {
      display: flex;
      justify-content: space-around;
      margin: 35px 0;
      flex-wrap: wrap;
    }

    .time-unit {
      margin: 12px;
      padding: 18px;
      background: rgba(255, 255, 255, 0.75);
      border-radius: 18px;
      min-width: 110px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.07);
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    .time-unit:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
    }

    .time-unit::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: left 0.6s;
    }

    .time-unit:hover::before {
      left: 100%;
    }

    .time-value {
      font-size: 2.8rem;
      font-weight: bold;
      color: #ff6b8b;
      margin-bottom: 8px;
      transition: color 0.3s ease;
    }

    .time-label {
      font-size: 1.1rem;
      color: #8a6d8f;
      font-weight: 500;
    }

    /* çºªå¿µæ—¥éƒ¨åˆ† */
    .milestone {
      margin: 25px 0;
      padding: 20px;
      background: rgba(255, 235, 238, 0.75);
      border-radius: 18px;
      font-size: 1.2rem;
      animation: pulse 2s infinite;
      border: 1px solid rgba(255, 182, 193, 0.3);
    }

    /* æŒ‰é’®æ ·å¼ */
    .btn-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
    }

    .btn {
      background: #ff6b8b;
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 50px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 18px rgba(255, 107, 139, 0.4);
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    .btn:hover {
      background: #ff8fa3;
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(255, 107, 139, 0.6);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    /* åŠ¨ç”» */
    @keyframes float {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
      }

      50% {
        transform: translateY(-25px) rotate(5deg);
      }
    }

    @keyframes heartbeat {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.15);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.02);
      }
    }

    .heartbeat {
      animation: heartbeat 1.5s infinite;
      display: inline-block;
      margin: 0 10px;
      color: #ff6b8b;
    }

    /* æ¨¡æ€æ¡†æ ·å¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.75);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      animation: fadeIn 0.3s ease-out;
    }

    .modal-content {
      background: white;
      padding: 35px;
      border-radius: 20px;
      text-align: center;
      max-width: 320px;
      width: 90%;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.5s ease-out;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #999;
      transition: color 0.3s;
    }

    .modal-close:hover {
      color: #ff6b8b;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 600px) {
      .container {
        padding: 25px 20px;
        border-radius: 20px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .header p {
        font-size: 1.1rem;
      }

      .time-unit {
        min-width: 85px;
        padding: 15px 10px;
        margin: 8px;
      }

      .time-value {
        font-size: 2.2rem;
      }

      .time-label {
        font-size: 1rem;
      }

      .btn {
        padding: 12px 20px;
        font-size: 1rem;
      }

      .timer {
        margin: 25px 0;
      }
    }

    @media (max-width: 400px) {
      .time-unit {
        min-width: 70px;
      }

      .time-value {
        font-size: 1.8rem;
      }
    }

    /* åŠ è½½åŠ¨ç”» */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <!-- å¿ƒå½¢èƒŒæ™¯ -->
  <div class="heart-bg" id="heartBg"></div>

  <!-- ä¸»å®¹å™¨ -->
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-heart heartbeat"></i> å°è‹¹æœå’Œå®å® <i class="fas fa-heart heartbeat"></i></h1>
      <p>å·²ç»åœ¨ä¸€èµ·åº¦è¿‡äº†ï¼š</p>
    </div>

    <div class="timer">
      <div class="time-unit">
        <div class="time-value" id="days">0</div>
        <div class="time-label">å¤©</div>
      </div>
      <div class="time-unit">
        <div class="time-value" id="hours">00</div>
        <div class="time-label">å°æ—¶</div>
      </div>
      <div class="time-unit">
        <div class="time-value" id="minutes">00</div>
        <div class="time-label">åˆ†é’Ÿ</div>
      </div>
      <div class="time-unit">
        <div class="time-value" id="seconds">00</div>
        <div class="time-label">ç§’</div>
      </div>
    </div>

    <div class="milestone" id="milestone">
      <!-- çºªå¿µæ—¥ä¿¡æ¯ä¼šåŠ¨æ€æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
    </div>

    <div class="btn-container">
      <button class="btn" id="themeBtn">
        <i class="fas fa-palette"></i> åˆ‡æ¢ä¸»é¢˜
      </button>
      <button class="btn" id="shareBtn">
        <i class="fas fa-share-alt"></i> åˆ†äº«ç”œèœœ
      </button>
    </div>
  </div>

  <script>
    // è®¾ç½®æ‹çˆ±å¼€å§‹çš„æ—¥æœŸå’Œæ—¶é—´
    const startDate = new Date('2025-09-04T00:00:00');

    // çºªå¿µæ—¥æ•°æ®
    const milestones = [
      { days: 100, name: "ğŸ’ æ‹çˆ±100å¤©", message: "ç™¾åˆ†ç™¾çš„çˆ±ç»™ä½ ï¼" },
      { days: 200, name: "ğŸŒ¹ æ‹çˆ±200å¤©", message: "çˆ±æ„å¦‚ç«ç‘°ç»½æ”¾ï¼" },
      { days: 365, name: "ğŸ‰ æ‹çˆ±ä¸€å‘¨å¹´", message: "å‘¨å¹´å¿«ä¹ï¼" },
      { days: 520, name: "ğŸ’– æ‹çˆ±520å¤©", message: "æˆ‘çˆ±ä½ ï¼" },
      { days: 999, name: "ğŸŒŸ æ‹çˆ±999å¤©", message: "é•¿é•¿ä¹…ä¹…ï¼" }
    ];

    // ä¸»é¢˜é¢œè‰²
    const themes = [
      {
        primary: "#ff6b8b",
        secondary: "#8a6d8f",
        bg: "linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)",
        heart: "#ff6b8b"
      },
      {
        primary: "#6a8caf",
        secondary: "#4a6572",
        bg: "linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)",
        heart: "#6a8caf"
      },
      {
        primary: "#6b5b95",
        secondary: "#4b3b6d",
        bg: "linear-gradient(135deg, #d9a7c7 0%, #fffcdc 100%)",
        heart: "#6b5b95"
      },
      {
        primary: "#44a08d",
        secondary: "#2d6a6d",
        bg: "linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%)",
        heart: "#44a08d"
      },
      {
        primary: "#e65c78",
        secondary: "#8a4b6e",
        bg: "linear-gradient(135deg, #ffafbd 0%, #ffc3a0 100%)",
        heart: "#e65c78"
      }
    ];

    let currentTheme = 0;
    let animationFrameId = null;

    // åˆå§‹åŒ–å¿ƒå½¢èƒŒæ™¯ - ä¼˜åŒ–æ€§èƒ½
    function initHeartBackground() {
      const heartBg = document.getElementById('heartBg');
      // æ ¹æ®å±å¹•å°ºå¯¸è®¡ç®—åˆé€‚çš„å¿ƒå½¢æ•°é‡
      const heartCount = Math.min(40, Math.floor((window.innerWidth * window.innerHeight) / 15000));

      // æ¸…ç©ºç°æœ‰å¿ƒå½¢
      heartBg.innerHTML = '';

      for (let i = 0; i < heartCount; i++) {
        const heart = document.createElement('div');
        heart.innerHTML = 'â¤';
        heart.classList.add('heart');

        // éšæœºä½ç½®
        heart.style.left = `${Math.random() * 100}%`;
        heart.style.top = `${Math.random() * 100}%`;

        // éšæœºåŠ¨ç”»å»¶è¿Ÿå’ŒæŒç»­æ—¶é—´
        heart.style.animationDelay = `${Math.random() * 12}s`;
        heart.style.animationDuration = `${6 + Math.random() * 10}s`;

        // éšæœºå¤§å°
        const size = 16 + Math.random() * 12;
        heart.style.fontSize = `${size}px`;

        heartBg.appendChild(heart);
      }
    }

    // é«˜ç²¾åº¦è®¡æ—¶å™¨ - é¿å…setIntervalå»¶è¿Ÿé—®é¢˜ [1](@ref)
    function startLoveTimer() {
      let lastTime = Date.now();

      function update() {
        const now = Date.now();
        const diff = now - lastTime;

        // åªæœ‰å½“è·ç¦»ä¸Šæ¬¡æ›´æ–°è¶…è¿‡900msæ‰æ›´æ–°ï¼Œé¿å…è¿‡åº¦æ¸²æŸ“ [8](@ref)
        if (diff >= 900) {
          updateLoveTimer();
          lastTime = now;
        }

        animationFrameId = requestAnimationFrame(update);
      }

      animationFrameId = requestAnimationFrame(update);
    }

    // æ›´æ–°è®¡æ—¶å™¨
    function updateLoveTimer() {
      const now = new Date();
      const diff = now - startDate;

      // è®¡ç®—æ—¶é—´å·®
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / (1000 * 60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      // å¹³æ»‘æ›´æ–°DOM [8](@ref)
      smoothUpdate('days', days);
      smoothUpdate('hours', hours.toString().padStart(2, '0'));
      smoothUpdate('minutes', minutes.toString().padStart(2, '0'));
      smoothUpdate('seconds', seconds.toString().padStart(2, '0'));

      // æ£€æŸ¥å¹¶æ˜¾ç¤ºçºªå¿µæ—¥
      checkMilestone(days);
    }

    // å¹³æ»‘æ›´æ–°æ•°å€¼
    function smoothUpdate(elementId, newValue) {
      const element = document.getElementById(elementId);
      if (element.textContent !== newValue.toString()) {
        element.style.transform = 'scale(1.1)';
        element.textContent = newValue;
        setTimeout(() => {
          element.style.transform = 'scale(1)';
        }, 150);
      }
    }

    // æ£€æŸ¥çºªå¿µæ—¥
    function checkMilestone(days) {
      const milestoneElement = document.getElementById('milestone');
      let nextMilestone = null;
      let achievedMilestone = null;

      // æŸ¥æ‰¾ä¸‹ä¸€ä¸ªçºªå¿µæ—¥å’Œå·²å®ç°çš„çºªå¿µæ—¥
      for (const milestone of milestones) {
        if (days >= milestone.days) {
          achievedMilestone = milestone;
        } else if (!nextMilestone) {
          nextMilestone = milestone;
          break;
        }
      }

      if (achievedMilestone && (!nextMilestone || days - achievedMilestone.days < 7)) {
        // æ˜¾ç¤ºæœ€è¿‘å®ç°çš„çºªå¿µæ—¥ï¼ˆä¸€å‘¨å†…ï¼‰
        milestoneElement.innerHTML = `
                    <i class="fas fa-crown"></i> 
                    å·²åº†ç¥ <strong>${achievedMilestone.name}</strong>ï¼
                    <br><small>${achievedMilestone.message}</small>
                `;
        milestoneElement.style.background = 'rgba(255, 215, 0, 0.7)';
      } else if (nextMilestone) {
        // æ˜¾ç¤ºä¸‹ä¸€ä¸ªçºªå¿µæ—¥å€’è®¡æ—¶
        const daysLeft = nextMilestone.days - days;
        milestoneElement.innerHTML = `
                    <i class="fas fa-gift"></i> 
                    è·ç¦» <strong>${nextMilestone.name}</strong> è¿˜æœ‰ <strong>${daysLeft}</strong> å¤©
                    <br><small>${nextMilestone.message}</small>
                `;
        milestoneElement.style.background = 'rgba(255, 235, 238, 0.75)';
      } else {
        // å¦‚æœå·²ç»è¿‡äº†æ‰€æœ‰çºªå¿µæ—¥
        const lastMilestone = milestones[milestones.length - 1];
        milestoneElement.innerHTML = `
                    <i class="fas fa-infinity"></i> 
                    çˆ±æ„æŒç»­å¢é•¿ä¸­...
                    <br><small>å·²è¶…è¶Š ${lastMilestone.name}ï¼</small>
                `;
        milestoneElement.style.background = 'rgba(200, 230, 255, 0.75)';
      }
    }

    // åˆ‡æ¢ä¸»é¢˜
    function changeTheme() {
      currentTheme = (currentTheme + 1) % themes.length;
      const theme = themes[currentTheme];

      // å¹³æ»‘è¿‡æ¸¡èƒŒæ™¯
      document.body.style.background = theme.bg;

      // æ›´æ–°æ‰€æœ‰æ—¶é—´å•ä½çš„é¢œè‰²
      const timeValues = document.querySelectorAll('.time-value');
      timeValues.forEach(value => {
        value.style.color = theme.primary;
      });

      // æ›´æ–°æŒ‰é’®é¢œè‰²
      const buttons = document.querySelectorAll('.btn');
      buttons.forEach(button => {
        button.style.background = theme.primary;
      });

      // æ›´æ–°å¿ƒå½¢é¢œè‰²
      const hearts = document.querySelectorAll('.heart');
      hearts.forEach(heart => {
        heart.style.color = theme.heart;
      });

      // æ›´æ–°æ ‡é¢˜é¢œè‰²
      const headers = document.querySelectorAll('.header h1');
      headers.forEach(header => {
        header.style.color = theme.primary;
      });
    }

    // åˆ†äº«åŠŸèƒ½
    function shareLove() {
      const days = document.getElementById('days').textContent;
      const message = `å°è‹¹æœå’Œå®å®å·²ç»ç›¸çˆ± ${days} å¤©äº†ï¼ğŸ’– æˆ‘ä»¬çš„çˆ±è¿˜åœ¨ç»§ç»­...`;
      const shareUrl = window.location.href;

      // æ·»åŠ åŠ è½½çŠ¶æ€
      const shareBtn = document.getElementById('shareBtn');
      const originalHTML = shareBtn.innerHTML;
      shareBtn.innerHTML = '<div class="loading"></div> ç”Ÿæˆä¸­...';
      shareBtn.disabled = true;

      setTimeout(() => {
        // ä¼˜å…ˆå°è¯•ä½¿ç”¨ Web Share API
        if (navigator.share) {
          navigator.share({
            title: 'æˆ‘ä»¬çš„æ‹çˆ±æ—¶é’Ÿ',
            text: message,
            url: shareUrl
          }).catch(err => {
            console.log('åˆ†äº«è¢«å–æ¶ˆæˆ–å¤±è´¥ï¼Œä½¿ç”¨äºŒç»´ç å¤‡ç”¨æ–¹æ¡ˆ:', err);
            showQRCodeModal(shareUrl, message);
          }).finally(() => {
            restoreShareButton(shareBtn, originalHTML);
          });
        } else {
          // å¦‚æœä¸æ”¯æŒ Web Share APIï¼Œç›´æ¥æ˜¾ç¤ºäºŒç»´ç 
          showQRCodeModal(shareUrl, message);
          restoreShareButton(shareBtn, originalHTML);
        }
      }, 500);
    }

    // æ¢å¤åˆ†äº«æŒ‰é’®çŠ¶æ€
    function restoreShareButton(button, originalHTML) {
      button.innerHTML = originalHTML;
      button.disabled = false;
    }

    // æ˜¾ç¤ºäºŒç»´ç å¼¹çª—
    function showQRCodeModal(url, message) {
      // åˆ›å»ºæ¨¡æ€æ¡†å®¹å™¨
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.id = 'qrcodeModal';

      // æ¨¡æ€æ¡†å†…å®¹
      modal.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close" id="modalClose">&times;</button>
                    <h3 style="margin-top: 0; color: #ff6b8b; margin-bottom: 15px;">åˆ†äº«æˆ‘ä»¬çš„çˆ±</h3>
                    <p style="margin-bottom: 20px; line-height: 1.5;">${message}</p>
                    <div id="qrcode-container" style="margin: 20px auto;"></div>
                    <p style="font-size: 0.9em; color: #666; margin: 15px 0;">æ‰«æäºŒç»´ç ï¼Œåˆ†äº«ç”œèœœ</p>
                    <button class="btn" id="downloadQRCode" style="margin: 10px auto;">
                        <i class="fas fa-download"></i> ä¸‹è½½äºŒç»´ç 
                    </button>
                </div>
            `;

      // å°†æ¨¡æ€æ¡†æ·»åŠ åˆ°é¡µé¢
      document.body.appendChild(modal);

      // ç”ŸæˆäºŒç»´ç 
      setTimeout(() => {
        QRCode.toCanvas(document.getElementById('qrcode-container'), url, {
          width: 200,
          height: 200,
          margin: 1,
          colorDark: themes[currentTheme].primary,
          colorLight: "#ffffff",
        }, function (error) {
          if (error) {
            console.error('ç”ŸæˆäºŒç»´ç å¤±è´¥:', error);
            document.getElementById('qrcode-container').innerHTML =
              '<p style="color:red; padding: 20px;">ç”ŸæˆäºŒç»´ç å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•ã€‚</p>';
          }
        });
      }, 100);

      // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
      document.getElementById('modalClose').addEventListener('click', () => {
        document.body.removeChild(modal);
      });

      document.getElementById('downloadQRCode').addEventListener('click', downloadQRCode);

      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
        }
      });
    }

    // ä¸‹è½½äºŒç»´ç 
    function downloadQRCode() {
      const canvas = document.querySelector('#qrcode-container canvas');
      if (canvas) {
        const link = document.createElement('a');
        link.download = 'æ‹çˆ±æ—¶é’ŸäºŒç»´ç .png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', () => {
      initHeartBackground();
      updateLoveTimer();
      startLoveTimer();

      // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
      document.getElementById('themeBtn').addEventListener('click', changeTheme);
      document.getElementById('shareBtn').addEventListener('click', shareLove);

      // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°åˆå§‹åŒ–å¿ƒå½¢èƒŒæ™¯
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          initHeartBackground();
        }, 250);
      });
    });

    // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
    window.addEventListener('beforeunload', () => {
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
      }
    });
  </script>
</body>

</html>
